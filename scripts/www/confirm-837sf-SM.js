import{r as m,z as q,h as X,b as l,l as o,d as N,g as D,F as g,i as A,M as Q,Y as K,Z as W,L as H,K as j,H as b,a9 as G,E as tt,o as n,t as h,J as et,C as ot}from"./.pnpm-B-_m2kGH.js";import{_ as st}from"./navBar-Sc4C80VW.js";import{u as at,a as lt,s as nt}from"./encoder-BznDzm-Z.js";import{u as rt}from"./station-DOwaTfnq.js";import{u as ct}from"./patrol-BIApQs8d.js";import{_ as ut}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-C1_hm9C_.js";import"./index-DyucNCMT.js";const it="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAZ9JREFUOE99UjFLW2EUPfe7L5ChBRdBqIOg0Lk4BKq+5pHRRUEhSyFSSV5xELGD4JJClw4OUlpeSQuCCilk6NDF6ekLdZMWnEIz2EnBPyDm3e+WPNvYJzF3vN8599zvnEu4r0rhCBw4aOMCh158F0aphn/8iBFXVXWOCFkoYiU4BGoIcxXvp37/w/eImZVmTsR+TUAd2cZnr52A/HDMgNcBLRlkFuLg6UG3fatYbuZgdAiBmzzcLS5Hs0q6Z8k+QeCd3RD9aApXcoId7+rePwMwfvSOgAcSuEtk/OYmQd8o6JUNZrYGEZO11fywLTtMXIl2ASyA8E0Cd3EgMVE9OrcdO0NYDkeZ+Ze05GE/21ODytGsMfqJYztPyIeOeWwurbUeat7PQYrsRyGAvELbiTnsRzUosvLRfT5w1ZfNSba6ISJrN64uh6OGzSkx+/Jh+ks/slM5Lih1RiR4tp/OsRIVDLQBUN2SvO1mlQx4EU6YDK+SalGI5hC439PE2yvpxlPUv7KkcEBUF8jr3rDU5fy/Xz50MI4xMBxc46zfYfwBJYud/WXfLkMAAAAASUVORK5CYII=",dt={class:"confirm"},mt={class:"confirm_content"},vt={class:"label"},pt={class:"label"},ft={class:"table"},_t={class:"table-content"},Lt={class:"items"},gt={class:"names"},Nt={class:"names"},At={class:"names"},ht={class:"names"},xt={class:"names last"},Ct={__name:"confirm",setup(It){const O=at(),P=rt(),y=X(),F=tt(),M=ct(),E=m(null),Y=m([]),x=m(!1),R=m([]),$=({selectedValues:c,selectedOptions:e})=>{var v;const[a,u,t]=c[0].split("-"),L=w.value,r=S.value,i=U.value,s=_.value.collectorList[L];if(s&&s.taxDataList[r]){const d=s.taxDataList[r].gunDataItemList[i];d&&(d.routerCollectorNo=a,d.routerGunNo=u,d.coderVolume=t,d.text=((v=e[0])==null?void 0:v.text)||"")}x.value=!1},w=m(null),S=m(null),U=m(null),Z=(c,e,a,u)=>{R.value=c.coderDataList.map(t=>({text:`${t.routerCollectorNo}-${t.routerGunNo}-${t.volume}`,value:`${t.routerCollectorNo}-${t.routerGunNo}-${t.volume}`})),w.value=e,S.value=a,U.value=u,x.value=!0},z=c=>{const e=new Map,a=[];return c.forEach(u=>{var t;(t=u.taxDataList)==null||t.forEach(L=>{var r;(r=L.gunDataItemList)==null||r.forEach(i=>{var v;const s=(v=i.text)==null?void 0:v.trim();s&&(e.has(s)?a.includes(s)||a.push(s):e.set(s,1))})})}),a},T=async()=>{E.value.validate().then(async()=>{const c=z(_.value.collectorList);if(c.length>0){ot(`以下编码器数据重复使用：${c.join(", ")}`);return}const e=_.value.collectorList.map((t,L)=>({collectorNo:t.collectorNo,pulsesRate:I.value.map(r=>r.pulsesRate)[L],machineNo:t.machineNo,taxDataList:t.taxDataList.map(r=>({taxNo:r.taxNo,gunDataItemList:r.gunDataItemList.map(i=>({gunNo:i.gunNo,routerCollectorNo:i.routerCollectorNo,routerGunNo:i.routerGunNo,unitPrice:i.unitPrice}))}))})),a={stationId:C.value,gatewayNo:_.value.gatewayNo,collectorList:e};b({message:"提交中...",forbidClick:!0,duration:0});let u=await nt(a);G(),u.code==200&&F.replace({path:M.path,query:{id:C.value}})})},C=m(null),I=m([]),_=m({}),V=async()=>{b({message:"数据查询中...",forbidClick:!0,duration:0});const c={stationId:C.value,collectorList:I.value};let e=await lt(c);G(),_.value=e.data,_.value.collectorList.forEach(a=>{a.taxDataList.forEach(u=>{u.gunDataItemList.forEach(t=>{!t.routerCollectorNo||!t.routerGunNo?t.text="":t.text=`${t.routerCollectorNo}-${t.routerGunNo}-${t.coderVolume}`})})})},J=()=>{V()};return q(()=>{C.value=y.query.id?y.query.id:P.stationId,I.value=O.encoderInfo,V()}),(c,e)=>{const a=st,u=et,t=Q,L=K,r=W,i=j;return n(),l(g,null,[o("div",dt,[N(a,{title:"编码器安装"}),o("div",mt,[o("div",{class:"confirm_content_item_title"},[e[3]||(e[3]=o("div",{class:"title"},"数据匹配",-1)),o("div",{class:"subtitle",onClick:J},e[2]||(e[2]=[o("img",{class:"img",src:it,alt:""},null,-1),o("span",{class:"text"},"重新刷新数据",-1)]))]),N(t,{ref_key:"formRef",ref:E},{default:D(()=>[(n(!0),l(g,null,A(_.value.collectorList,(s,v)=>(n(),l("div",{class:"confirm_content_item",key:v},[o("div",vt,"采集器编号: "+h(s.collectorNo),1),o("div",pt,"加油机出厂编号: "+h(s.machineNo),1),o("div",ft,[e[4]||(e[4]=o("div",{class:"table-title"},[o("div",{class:"title-item"},"采集器串口"),o("div",{class:"title-item"},"消费金额/元"),o("div",{class:"title-item"},"油量/L"),o("div",{class:"title-item"},"单价/元"),o("div",{class:"title-item last"},"编码器数据")],-1)),o("div",_t,[(n(!0),l(g,null,A(s.taxDataList,(d,k)=>(n(),l("div",{key:k,class:"content-item"},[o("div",Lt,[o("div",gt,"com"+h(k+1),1),o("div",Nt,[(n(!0),l(g,null,A(d.gunDataItemList,(p,f)=>(n(),l("div",{class:"gunItem",key:f},h(p.amount),1))),128))]),o("div",At,[(n(!0),l(g,null,A(d.gunDataItemList,(p,f)=>(n(),l("div",{class:"gunItem",key:f},h(p.volume),1))),128))]),o("div",ht,[(n(!0),l(g,null,A(d.gunDataItemList,(p,f)=>(n(),l("div",{class:"gunItem",key:f},h(p.unitPrice),1))),128))]),o("div",xt,[(n(!0),l(g,null,A(d.gunDataItemList,(p,f)=>(n(),l("div",{class:"gunItem",key:f},[N(u,{modelValue:p.text,"onUpdate:modelValue":B=>p.text=B,"is-link":"",readonly:"",name:"picker",placeholder:"请选择",onClick:B=>Z(s,v,k,f),rules:[{required:!0,message:"请选择",trigger:"onChange"}]},null,8,["modelValue","onUpdate:modelValue","onClick"])]))),128))])])]))),128))])])]))),128))]),_:1},512)])]),N(r,{show:x.value,"onUpdate:show":e[1]||(e[1]=s=>x.value=s),"destroy-on-close":"",position:"bottom"},{default:D(()=>[N(L,{columns:R.value,"model-value":Y.value,onConfirm:$,onCancel:e[0]||(e[0]=s=>x.value=!1)},null,8,["columns","model-value"])]),_:1},8,["show"]),N(i,{color:"#0368C2",type:"primary",onClick:T},{default:D(()=>e[5]||(e[5]=[H("提交")])),_:1})],64)}}},Vt=ut(Ct,[["__scopeId","data-v-514fd09d"]]);export{Vt as default};
