import{r as n,z,h as M,H as O,b as m,d as u,l as c,F as G,i as H,g as p,M as J,J as K,U as Q,D as W,E as X,o as h,A as Y,G as D,t as w,L as Z,Q as tt,K as et,R as at,C}from"./.pnpm-B-_m2kGH.js";import{o as st,d as lt}from"./index-CpPjdPay.js";import{p as ot}from"./index-4hp_MxG3.js";import{_ as nt}from"./navBar-Sc4C80VW.js";import{u as ut,a as y}from"./dict-CwYOActj.js";import{u as rt}from"./station-DOwaTfnq.js";import{u as it}from"./patrol-BIApQs8d.js";import{u as ct}from"./displayType-DRjpup3F.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-C1_hm9C_.js";import"./index-DyucNCMT.js";const pt={class:"installType"},ft={class:"list"},vt=["onClick"],_t={class:"title"},mt={class:"right"},ht={style:{color:"#c1c1c1"}},yt={__name:"index",setup(gt){const{install_status:f}=ut("install_status"),g=X(),T=M(),I=rt(),V=it(),U=ct(),A=async()=>{g.replace("/setup")},v=n([{title:"显示屏安装",status:"",path:"/display",show:!0,flag:!0},{title:"液位仪安装",status:"",path:"/level",show:!0,flag:!0},{title:"报税口安装",status:"",path:"/tax",show:!0,flag:!0},{title:"编码器安装",status:"",path:"/encoder",show:!0,flag:!0}]),R=(t,e)=>{if(V.path="/installType",e=="显示屏安装"){let o=v.value.filter(l=>l.title=="报税口安装")[0];U.taxStatus=o.status=="安装完成"?1:0,g.push({path:"/displayType",query:{id:_.value}});return}g.push({path:t,query:{id:_.value}})},k=n(!1),b=n(null),r=n({}),q=async t=>{t.status="uploading",t.message="上传中...";const e=new FormData;e.append("file",t.file),e.append("fileType","59");let o=await st(e);t.status="done ",t.message="上传成功",r.value.fileUrl=o.data},F=t=>{if(t=="confirm")return new Promise((e,o)=>{b.value.validate().then(async()=>{let l={stationId:I.stationId,remark:r.value.remark,fileUrl:r.value.fileUrl,deviceType:d.value},i=await lt(l);i.code==200?(C("提交成功"),x(),e(!0)):(C(i.msg),e(!1))}).catch(l=>{console.log("校验失败",l),e(!1)})});if(t=="cancel")return r.value={},!0},_=n(null);z(()=>{_.value=T.query.id||I.stationId,x()}),n(null);const S=n(!1),x=async()=>{S.value=O({message:"加载中...",forbidClick:!0,duration:0}),v.value.forEach(t=>{t.flag=!1}),await B(),S.value.close()},L=n({}),B=async()=>{let t=await ot({id:_.value});if(t.code==200){L.value=t.data;const{screenInstall:e,taxInstall:o,coderInstall:l,opwInstall:i}=t.data;v.value.forEach(s=>{s.title=="显示屏安装"?(s.status=y(e.installStatus,f.value),s.isAuto=e.skipInstall):s.title=="报税口安装"?(s.status=y(o.installStatus,f.value),s.isAuto=o.skipInstall):s.title=="编码器安装"?(s.status=y(l.installStatus,f.value),s.isAuto=l.skipInstall):s.title=="液位仪安装"&&(s.status=y(i.installStatus,f.value),s.isAuto=i.skipInstall)})}},d=n(null),E=async t=>{if(t.status=="已安装"){C("已安装完成,无需跳过");return}switch(t.title){case"显示屏安装":d.value=3;break;case"报税口安装":d.value=1;break;case"编码器安装":d.value=2;break;case"液位仪安装":d.value=5;break}k.value=!0};return(t,e)=>{const o=tt,l=et,i=at,s=K,N=J,P=Q,$=W;return h(),m("div",null,[u(nt,{title:"安装类型",onClickLeft:A}),c("div",pt,[c("div",ft,[(h(!0),m(G,null,H(v.value,a=>(h(),m("div",{key:a.title,onClick:j=>R(a.path,a.title)},[u(i,{"right-width":"85"},{right:p(()=>[u(l,{square:"",type:"danger",text:"跳过安装",style:{height:"100%"},onClick:j=>E(a)},null,8,["onClick"])]),default:p(()=>[a.show?(h(),m("div",{key:0,class:D(["item",a.flag?" checked":""])},[c("div",_t,w(a.title),1),c("div",mt,[c("div",{class:D(["status",a.status=="已安装"?"status":"activeStatus"])},[Z(w(a.status)+" ",1),c("span",ht,w(a.isAuto?"(已跳过安装)":""),1)],2),u(o,{name:"arrow",color:"#CACCD9"})])],2)):Y("",!0)]),_:2},1024)],8,vt))),128))])]),u($,{show:k.value,"onUpdate:show":e[2]||(e[2]=a=>k.value=a),title:"跳过安装申请","show-cancel-button":"","destroy-on-close":"",beforeClose:F},{default:p(()=>[u(N,{ref_key:"formRef",ref:b},{default:p(()=>[u(s,{type:"textarea",modelValue:r.value.remark,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.remark=a),name:"remark",label:"说明备注",placeholder:"说明备注",rules:[{required:!0,message:"请填写说明备注"}]},null,8,["modelValue"])]),_:1},512),u(s,{name:"uploader",label:"现场照片"},{input:p(()=>[u(P,{modelValue:r.value.value,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.value=a),"after-read":q,"max-count":1},null,8,["modelValue"])]),_:1})]),_:1},8,["show"])])}}},At=dt(yt,[["__scopeId","data-v-e44eb219"]]);export{At as default};
