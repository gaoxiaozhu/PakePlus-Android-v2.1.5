import{b as p,o as r,l as t,A as nt,G as J,t as w,h as ct,z as mt,r as C,d as y,g as j,J as it,M as dt,F as B,H as et,a9 as at,u as O,V as _t,i as A,Z as vt,Y as pt,W as xt,X as ft,C as tt,E as ht,L as gt,Q as yt,K as Lt,a8 as Nt,a6 as rt,ag as wt,w as Ct,j as lt}from"./.pnpm-B-_m2kGH.js";import{_ as kt}from"./navBar-Sc4C80VW.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{m as H}from"./request-C1_hm9C_.js";import{u as ut,a as Q}from"./dict-CwYOActj.js";import{u as It}from"./patrol-BIApQs8d.js";import"./index-DyucNCMT.js";const bt={class:"stepComponent"},Dt={class:"lineWrap"},St={__name:"step",props:{number:{type:Number||String,default:1},name:{type:String,default:"stepComponent"},status:{type:String,default:"none"},showNextLine:{type:Boolean,default:!0}},setup(s){return(Z,S)=>(r(),p("div",bt,[t("div",Dt,[t("div",{class:J(["icon",s.status==="success"?"active":""])},w(s.number),3),s.showNextLine?(r(),p("div",{key:0,class:J(["line",s.status=="success"?"activeLine":""])},"---",2)):nt("",!0)]),t("div",{class:J(["name",s.status==="success"?"activeName":""])},w(s.name),3)]))}},$t=st(St,[["__scopeId","data-v-c80b08b6"]]),Vt=s=>H({url:"/operator/tax/operate/query/gateway",method:"post",data:s}),Pt=s=>H({url:"/operator/station/operate/getStationInfo",method:"post",data:s}),Tt=s=>H({url:"/operator/tax/operate/check/gateway",method:"post",data:s}),qt=s=>H({url:"/operator/tax/operate/query/machine/installStatus",method:"post",data:s}),Ut=s=>H({url:"/operator/tax/operate/query/gatewayStatus",method:"post",data:s}),Et=s=>H({url:"/operator/tax/operate/query/collector",method:"post",data:s}),Bt=s=>H({url:"/operator/tax/operate/check/collector",method:"post",data:s}),Ht=s=>H({url:"/operator/tax/operate/query/status",method:"post",data:s}),Gt=s=>H({url:"/operator/tax/operate/reboot",method:"post",data:s}),Mt=s=>H({url:"/operator/tax/operate/connection",method:"post",data:s}),Rt=s=>H({url:"/operator/tax/operate/submit/tax/status",method:"post",data:s}),Ft=s=>H({url:"/operator/tax/operate/query/tax/data",method:"post",data:s}),At=s=>H({url:"/operator/tax/operate/refreshTaxData",method:"post",data:s}),Zt=s=>H({url:"/operator/tax/operate/submit",method:"post",data:s}),Qt={class:"routerComponent"},zt={class:"form"},jt=["src"],Kt={__name:"router",emits:["next","prev","sendGatewayNo"],setup(s,{emit:Z}){const S=Z,x=ct(),T=async d=>{let L=await Pt({id:d});g.value.name=L.data.name},G=async()=>{let d=await Vt({id:x.query.id});g.value=d.data,T(x.query.id)};mt(()=>{G()});const k=C(null),g=C({value:"",name:""}),F=()=>{S("prev",1)},b=()=>{k.value.validate().then(()=>{et({message:"校验中...",forbidClick:!0,duration:0});let d={id:x.query.id,gatewayNo:g.value.gatewayNo};Tt(d).then(L=>{at(),L.code==200&&(S("sendGatewayNo",g.value.gatewayNo),S("next",1))})})};return(d,L)=>{const q=it,N=dt;return r(),p(B,null,[t("div",Qt,[t("div",zt,[y(N,{ref_key:"formRef",ref:k},{default:j(()=>[L[2]||(L[2]=t("div",{class:"title"},"加油机路由器数据",-1)),y(q,{readonly:"",border:!1,modelValue:g.value.name,"onUpdate:modelValue":L[0]||(L[0]=m=>g.value.name=m),label:"加油站名称",placeholder:"加油站名称",rules:[{required:!0,message:"请填写加油站名称"}]},null,8,["modelValue"]),y(q,{name:"uploader",label:"营业执照"},{input:j(()=>[t("img",{class:"img",src:g.value.showBusinessLicensePic,alt:""},null,8,jt)]),_:1}),y(q,{border:!1,modelValue:g.value.gatewayNo,"onUpdate:modelValue":L[1]||(L[1]=m=>g.value.gatewayNo=m),label:"路由器编号",placeholder:"路由器编号",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"])]),_:1},512)])]),t("div",{class:"footer"},[t("div",{class:"btn",onClick:F},"上一步"),t("div",{class:"nexBtn",onClick:b},"下一步")])],64)}}},Ot=st(Kt,[["__scopeId","data-v-48f57ba4"]]),Wt={class:"collector"},Jt={class:"content"},Xt={class:"num"},Yt={class:"form"},te={class:"status"},ee={__name:"collector",props:["gatewayNo"],emits:["next","prev","sendCollectorList"],setup(s,{emit:Z}){const{gun_status:S}=ut("gun_status"),x=ct(),T=Z,G=s,{ref_line_status:k}=ut("ref_line_status"),g=C([]),F=async()=>{const v=(await qt({id:x.query.id})).data.map(a=>({text:a.machineNo,value:a.machineId}));g.value=v,N.value.list.forEach(a=>{a.columns=v})},b=C({}),d=async()=>{const e={id:x.query.id,gatewayNo:G.gatewayNo};let v=await Ut(e);b.value=v.data},L=async()=>{const e=[{text:"启用",value:1},{text:"停用",value:0},{text:"维修",value:2}];let v=await Et({id:x.query.id});v.data&&(N.value.list=v.data.map((a,f)=>{var K;const M=Array.isArray(a.taxItemList)?a.taxItemList:[];for(;M.length<2;)M.push({status:"",taxNo:String(M.length+1)});return{uid:new Date().getTime()+f,showPicker:!1,collectorNo:a.collectorNo||"",machineId:a.machineId||"",address:((K=g.value.find(U=>U.value===a.machineId))==null?void 0:K.text)||"",columns:g.value,onConfirm:({selectedValues:U,selectedOptions:n},W)=>{var o;W.address=(o=n[0])==null?void 0:o.text,W.machineId=U[0],W.showPicker=!1},taxItemList:M.map(U=>{var $;return{name:{1:"com1",2:"com2"}[U.taxNo]||`com${U.taxNo}`,showPicker:!1,status:U.status!=null?U.status:"",taxNo:U.taxNo!=null?U.taxNo:"",statusName:(($=e.find(V=>V.value===U.status))==null?void 0:$.text)||"",onConfirm:({selectedValues:V,selectedOptions:u},c)=>{var l;c.statusName=(l=u[0])==null?void 0:l.text,c.status=V[0],c.showPicker=!1},columns:e}})}}))};mt(async()=>{await F(),await d(),await L()});const q=C(null),N=C({list:[{uid:new Date().getTime(),collectorNo:"",machineId:"",address:"",showPicker:!1,onConfirm:({selectedValues:e,selectedOptions:v},a)=>{var f;a.address=(f=v[0])==null?void 0:f.text,a.machineId=e[0],a.showPicker=!1},columns:g.value,taxItemList:[{name:"com1",showPicker:!1,taxNo:"1",status:"",statusName:"",onConfirm:({selectedValues:e,selectedOptions:v},a)=>{var f;a.statusName=(f=v[0])==null?void 0:f.text,a.status=e[0],a.showPicker=!1},columns:[{text:"启用",value:1},{text:"停用",value:0},{text:"维修",value:2}]},{name:"com2",showPicker:!1,taxNo:"2",status:"",statusName:"",onConfirm:({selectedValues:e,selectedOptions:v},a)=>{var f;a.statusName=(f=v[0])==null?void 0:f.text,a.status=e[0],a.showPicker=!1},columns:[{text:"启用",value:1},{text:"停用",value:0},{text:"维修",value:2}]}]}]}),m=()=>{N.value.list.push({uid:new Date().getTime(),collectorNo:"",machineId:"",address:"",showPicker:!1,onConfirm:({selectedValues:e,selectedOptions:v},a)=>{var f;a.address=(f=v[0])==null?void 0:f.text,a.machineId=e[0],a.showPicker=!1},columns:g.value,taxItemList:[{name:"com1",showPicker:!1,taxNo:"1",status:"",statusName:"",onConfirm:({selectedValues:e,selectedOptions:v},a)=>{var f;a.statusName=(f=v[0])==null?void 0:f.text,a.status=e[0],a.showPicker=!1},columns:[{text:"启用",value:1},{text:"停用",value:0},{text:"维修",value:2}]},{name:"com2",showPicker:!1,taxNo:"2",status:"",statusName:"",onConfirm:({selectedValues:e,selectedOptions:v},a)=>{var f;a.statusName=(f=v[0])==null?void 0:f.text,a.status=e[0],a.showPicker=!1},columns:[{text:"启用",value:1},{text:"停用",value:0},{text:"维修",value:2}]}]})},I=()=>{N.value.list.splice(N.value.list.length-1,1)},_=()=>{T("prev",2)},i=()=>{q.value.validate().then(async()=>{et({message:"校验中...",forbidClick:!0,duration:0});const e={gatewayNo:G.gatewayNo,collectorList:N.value.list.map(a=>({collectorNo:a.collectorNo,tax1Status:a.taxItemList[0].status,tax2Status:a.taxItemList[1].status,machineId:a.machineId}))};let v=await Bt(e);at(),v.code==200&&(T("next",2),T("sendCollectorList",N.value.list))})};return(e,v)=>{const a=_t,f=it,M=pt,K=vt,U=dt;return r(),p(B,null,[t("div",Wt,[v[1]||(v[1]=t("div",{class:"name"},"采集器安装",-1)),t("div",Jt,[t("div",{class:J(["state",b.value.status==0?"active":""])},w(O(Q)(b.value.status,O(k))),3),t("div",Xt,"路由器编号: "+w(s.gatewayNo),1),y(a,{class:"stepper",theme:"round","disable-input":"",integer:"",modelValue:N.value.list.length,"onUpdate:modelValue":v[0]||(v[0]=n=>N.value.list.length=n),"button-size":"18",onPlus:m,onMinus:I},null,8,["modelValue"])])]),t("div",Yt,[y(U,{ref_key:"formRef",ref:q},{default:j(()=>[(r(!0),p(B,null,A(N.value.list,(n,W)=>(r(),p("div",{class:"formList",key:n.uid},[y(f,{border:!1,modelValue:n.collectorNo,"onUpdate:modelValue":o=>n.collectorNo=o,name:"collectorNo",label:"采集器编号",placeholder:"采集器编号",rules:[{required:!0,message:"请填写采集器编号"}]},null,8,["modelValue","onUpdate:modelValue"]),y(f,{modelValue:n.address,"onUpdate:modelValue":o=>n.address=o,"is-link":"",readonly:"",name:"picker",label:"安装位置",placeholder:"点击选择安装位置",onClick:o=>n.showPicker=!0,rules:[{required:!0,message:"请选择安装位置"}]},null,8,["modelValue","onUpdate:modelValue","onClick"]),y(K,{show:n.showPicker,"onUpdate:show":o=>n.showPicker=o,"destroy-on-close":"",position:"bottom"},{default:j(()=>[y(M,{columns:n.columns,onConfirm:o=>n.onConfirm(o,n),onCancel:o=>n.showPicker=!1},null,8,["columns","onConfirm","onCancel"])]),_:2},1032,["show","onUpdate:show"]),v[2]||(v[2]=t("div",{class:"statusName"},"状态",-1)),t("div",te,[y(f,{modelValue:n.taxItemList[0].statusName,"onUpdate:modelValue":o=>n.taxItemList[0].statusName=o,"is-link":"",readonly:"",label:n.taxItemList[0].name,placeholder:"点击选择状态",onClick:o=>n.taxItemList[0].showPicker=!0,rules:[{required:!0,message:"请选择状态"}]},null,8,["modelValue","onUpdate:modelValue","label","onClick"]),y(K,{show:n.taxItemList[0].showPicker,"onUpdate:show":o=>n.taxItemList[0].showPicker=o,"destroy-on-close":"",position:"bottom"},{default:j(()=>[y(M,{columns:n.taxItemList[0].columns,onConfirm:o=>n.taxItemList[0].onConfirm(o,n.taxItemList[0]),onCancel:o=>n.taxItemList[0].showPicker=!1},null,8,["columns","onConfirm","onCancel"])]),_:2},1032,["show","onUpdate:show"]),y(f,{modelValue:n.taxItemList[1].statusName,"onUpdate:modelValue":o=>n.taxItemList[1].statusName=o,"is-link":"",readonly:"",label:n.taxItemList[1].name,placeholder:"点击选择状态",onClick:o=>n.taxItemList[1].showPicker=!0,rules:[{required:!0,message:"请选择状态"}]},null,8,["modelValue","onUpdate:modelValue","label","onClick"]),y(K,{show:n.taxItemList[1].showPicker,"onUpdate:show":o=>n.taxItemList[1].showPicker=o,"destroy-on-close":"",position:"bottom"},{default:j(()=>[y(M,{columns:n.taxItemList[1].columns,onConfirm:o=>n.taxItemList[1].onConfirm(o,n.taxItemList[1]),onCancel:o=>n.taxItemList[1].showPicker=!1},null,8,["columns","onConfirm","onCancel"])]),_:2},1032,["show","onUpdate:show"])])]))),128))]),_:1},512)]),t("div",{class:"footer"},[t("div",{class:"btn",onClick:_},"上一步"),t("div",{class:"nexBtn",onClick:i},"下一步")])],64)}}},ae=st(ee,[["__scopeId","data-v-f5033c2d"]]),se="data:image/svg+xml,%3csvg%20width='14'%20height='14'%20viewBox='0%200%2014%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='Frame'%3e%3cpath%20id='Vector'%20d='M7.5%202.45767C7.5%202.33487%207.44732%202.21709%207.35355%202.13025C7.25979%202.04341%207.13261%201.99463%207%201.99463C6.86739%201.99463%206.74021%202.04341%206.64645%202.13025C6.55268%202.21709%206.5%202.33487%206.5%202.45767V6.51822C6.5%206.64102%206.55268%206.7588%206.64645%206.84564C6.74021%206.93248%206.86739%206.98126%207%206.98126C7.13261%206.98126%207.25979%206.93248%207.35355%206.84564C7.44732%206.7588%207.5%206.64102%207.5%206.51822V2.45767Z'%20fill='%230368C2'/%3e%3cpath%20id='Vector_2'%20d='M3.28496%205.72087C3.62347%204.93947%204.22233%204.28656%204.98872%203.86335C5.10099%203.80144%205.18292%203.69945%205.21648%203.57983C5.25003%203.46021%205.23248%203.33276%205.16767%203.2255C5.10286%203.11825%204.99611%203.03998%204.8709%203.00792C4.74568%202.97586%204.61227%202.99264%204.5%203.05455C3.54679%203.5803%202.80181%204.39185%202.3806%205.36332C1.9594%206.33478%201.8855%207.41188%202.17037%208.42756C2.45525%209.44324%203.08297%2010.3407%203.95619%2010.9809C4.82941%2011.621%205.89933%2011.9679%207%2011.9679C8.10067%2011.9679%209.17059%2011.621%2010.0438%2010.9809C10.917%2010.3407%2011.5448%209.44324%2011.8296%208.42756C12.1145%207.41188%2012.0406%206.33478%2011.6194%205.36332C11.1982%204.39185%2010.4532%203.5803%209.5%203.05455C9.38773%202.99264%209.25432%202.97586%209.1291%203.00792C9.00389%203.03998%208.89714%203.11825%208.83233%203.2255C8.76752%203.33276%208.74997%203.46021%208.78352%203.57983C8.81708%203.69945%208.89901%203.80144%209.01128%203.86335C9.68095%204.2326%2010.225%204.77841%2010.5784%205.43543C10.9318%206.09245%2011.0794%206.83285%2011.0037%207.56797C10.928%208.3031%2010.6321%209.0018%2010.1515%209.58042C9.67084%2010.159%209.02583%2010.5931%208.29367%2010.8305C7.5615%2011.068%206.77321%2011.0989%206.02317%2010.9194C5.27313%2010.7399%204.59312%2010.3577%204.06456%209.81862C3.536%209.27948%203.18129%208.60624%203.04289%207.8795C2.9045%207.15275%202.98828%206.4033%203.28421%205.72087H3.28496Z'%20fill='%230368C2'/%3e%3c/g%3e%3c/svg%3e",oe="data:image/svg+xml,%3csvg%20width='14'%20height='14'%20viewBox='0%200%2014%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='Frame'%3e%3cpath%20id='Vector'%20d='M4.58488%207.55773H9.3697V6.36491H4.58488V7.55773ZM2.13244%206.96086C2.13244%205.58894%203.2084%204.51501%204.58488%204.51501H6.37929V3.38165H4.58488C2.61085%203.38165%200.996094%204.99211%200.996094%206.96086C0.996094%208.92957%202.61085%2010.5401%204.58488%2010.5401H6.37929V9.40672H4.58488C3.2084%209.40673%202.13244%208.33196%202.13244%206.96086ZM9.3697%203.38165H7.57528V4.51501H9.3697C10.7452%204.51501%2011.8212%205.58894%2011.8212%206.96086C11.8212%208.33194%2010.7452%209.40672%209.3697%209.40672H7.57528V10.5401H9.3697C11.3437%2010.5401%2012.9585%208.92957%2012.9585%206.96086C12.9585%204.99211%2011.3437%203.38165%209.3697%203.38165Z'%20fill='white'/%3e%3c/g%3e%3c/svg%3e",le={class:"devState"},ne={class:"item"},ue={class:"item"},ce={style:{"margin-bottom":"60px"}},re={class:"dev_title"},ie={class:"title"},de={class:"btns"},me=["onClick"],ve={class:"s2"},pe=["onClick"],xe={class:"info"},fe={class:"item_title"},he={class:"item_name"},_e={class:"item_num"},ge={class:"item_num"},ye={__name:"device",props:["gatewayNo","collectorList"],emits:["next","prev"],setup(s,{emit:Z}){ct();const S=Z,x=s,{ref_line_status:T,gun_status:G}=ut("ref_line_status","gun_status"),k=C(null),g=async N=>{et({message:"重启中...",forbidClick:!0,duration:0});const m={gatewayNo:x.gatewayNo,collectorNo:N.collectorNo};let I=await Gt(m);at(),I.code==200&&tt("重启成功")},F=async(N,m)=>{et({message:"连接加油机...",forbidClick:!0,duration:0});const I={gatewayNo:x.gatewayNo,collectorNo:N.collectorNo,tax1Status:x.collectorList[m].taxItemList[0].status,tax2Status:x.collectorList[m].taxItemList[1].status};let _=await Mt(I);at(),_.code==200&&tt("完成连接")},b=C({}),d=async()=>{let N={gatewayNo:x.gatewayNo,collectorNoList:x.collectorList.map(I=>I.collectorNo)},m=await Ht(N);b.value=m.data,b.value.collectorConnectStatusList.forEach((I,_)=>{I.taxConnectStatusList.forEach((i,e)=>{i.checkStatus=x.collectorList[_].taxItemList[e].status})})};xt(()=>{x.collectorList.length>0&&(d(),k.value&&(clearInterval(k.value),k.value=null),k.value=setInterval(()=>{d()},1e3))}),ft(()=>{k.value&&(clearInterval(k.value),k.value=null)});const L=()=>{S("prev",3)},q=async()=>{if(et({message:"校验中...",forbidClick:!0,duration:0}),b.value.status==0){tt("路由器状态离线，请检查路由器");return}if(!b.value.collectorConnectStatusList.every(_=>_.status==1)){tt("采集器设备状态离线，请检查采集器");return}let m={gatewayNo:x.gatewayNo,collectorTaxStatusList:b.value.collectorConnectStatusList.map(_=>({collectorNo:_.collectorNo,taxItemList:_.taxConnectStatusList.map(i=>({taxSn:i.taxSn,taxNo:i.taxNo,status:i.checkStatus,gunNum:i.gunTotal,checkStatus:i.checkStatus}))}))};for(let _=0;_<m.collectorTaxStatusList.length;_++)for(let i=0;i<m.collectorTaxStatusList[_].taxItemList.length;i++){if(m.collectorTaxStatusList[_].taxItemList[i].checkStatus==1&&!m.collectorTaxStatusList[_].taxItemList[i].taxSn){tt(`[采集器${_+1}] com${i+1}税控序列号为空`);return}if(m.collectorTaxStatusList[_].taxItemList[i].checkStatus==1&&!m.collectorTaxStatusList[_].taxItemList[i].gunNum){tt(`[采集器${_+1}] com${i+1}报税口最大枪数为空`);return}}let I=await Rt(m);at(),I.code==200&&S("next",3)};return(N,m)=>(r(),p(B,null,[t("div",le,[m[0]||(m[0]=t("div",{class:"title"},"设备状态",-1)),t("div",ne,[t("div",null,"数据路由器编号: "+w(s.gatewayNo),1),t("div",{class:J(["status-text",b.value.status==0?"active":""])},w(O(Q)(b.value.status,O(T))),3)]),t("div",ue,"心跳时间: "+w(b.value.heartbeatTime),1)]),t("div",ce,[(r(!0),p(B,null,A(b.value.collectorConnectStatusList,(I,_)=>(r(),p("div",{class:"collector-dev",key:_},[t("div",re,[t("div",ie,"采集器编号: "+w(I.collectorNo),1),t("div",{class:J(["status-text",I.status==0?"active":""])},w(O(Q)(I.status,O(T))),3)]),t("div",de,[t("div",{class:"s1",onClick:i=>g(I)},m[1]||(m[1]=[t("img",{class:"img",src:se,alt:""},null,-1),t("span",{class:"text"},"重启",-1)]),8,me),t("div",ve,[m[2]||(m[2]=t("img",{class:"img",src:oe,alt:""},null,-1)),t("div",{class:"text",onClick:i=>F(I,_)},"连接加油机",8,pe)])]),t("div",xe,[(r(!0),p(B,null,A(I.taxConnectStatusList,(i,e)=>(r(),p("div",{class:"info_item",key:e},[t("div",fe,[t("div",he,"com"+w(e+1)+": ",1),t("div",{class:J(["item_status",i.taxSn&&i.gunTotal?"active":""])},w(O(Q)(i.checkStatus,O(G)))+": 连接"+w(i.taxSn&&i.gunTotal?"成功":"失败"),3)]),t("div",_e,"税控序列号: "+w(i.taxSn),1),t("div",ge,"报税口最大枪数: "+w(i.gunTotal),1)]))),128))])]))),128))]),t("div",{class:"footer"},[t("div",{class:"btn",onClick:L},"上一步"),t("div",{class:"nexBtn",onClick:q},"下一步")])],64))}},Le=st(ye,[["__scopeId","data-v-824e5213"]]),Ne={class:"title"},we={class:"name"},Ce={class:"num"},ke={class:"data"},Ie={class:"item_title"},be={class:"num"},De={class:"table"},Se={class:"table-content"},$e={class:"items"},Ve={class:"names"},Pe={class:"names"},Te={class:"names"},qe={class:"names"},Ue={class:"names"},Ee={class:"names"},Be={class:"names"},He={__name:"oilConfig",props:["collectorList","gatewayNo"],emits:["next","prev"],setup(s,{emit:Z}){const S=Z,x=s,T=ct(),G=ht(),{gun_status:k,oil_type_status:g}=ut("gun_status","oil_type_status"),F=It(),b=C(null),d=C(!1),L=C([]),q=C(null),N=C(null),m=C(null),I=C(null),_=({selectedValues:o,selectedOptions:$})=>{U();const V=I.value,u=q.value,c=N.value,l=m.value,h=e.value[u].taxDataList[c].gunDataItemList[l];V=="oilType"?(h.oilTypeName=Q(o[0],g.value),h.oilType=o[0]):(h.statusName=Q(o[0],k.value),h.status=o[0]),d.value=!1},i=(o,$,V,u,c)=>{a&&(clearInterval(a),a=null),c=="oilType"?L.value=g.value.map(l=>({text:l.label,value:l.value,disabled:l.value==90})):L.value=k.value.map(l=>({text:l.label,value:l.value})),q.value=$,N.value=V,m.value=u,I.value=c,d.value=!0},e=C([]),v=async()=>{const o={gatewayNo:x.gatewayNo,collectorNoList:x.collectorList.map(V=>V.collectorNo)},$=await Ft(o);e.value=$.data.map((V,u)=>({collectorNo:V.collectorNo,taxDataList:V.taxDataList.map((c,l)=>({taxNo:c.taxNo,gunDataItemList:c.gunDataItemList.map((h,z)=>{var X,R,Y,P,E;const D=((E=(P=(Y=(R=(X=e.value)==null?void 0:X[u])==null?void 0:R.taxDataList)==null?void 0:Y[l])==null?void 0:P.gunDataItemList)==null?void 0:E[z])||{};return{amount:h.amount,gunNo:h.gunNo,unitPrice:h.unitPrice,volume:h.volume,oilType:D.oilType||h.oilType,oilTypeName:D.oilTypeName||Q(h.oilType,g.value),status:D.status||h.status,statusName:D.statusName||Q(h.status,k.value)}})}))})),e.value.forEach((V,u)=>{const c=x.collectorList.find(l=>l.collectorNo==V.collectorNo);V.taxDataList.forEach(l=>{var z;const h=(z=c.taxItemList)==null?void 0:z.find(D=>D.taxNo==l.taxNo);h&&(l.status=h.status,l.statusName=h.statusName,l.name=h.name),l.gunDataItemList&&Array.isArray(l.gunDataItemList)&&l.gunDataItemList.forEach(D=>{D.oilType!=null?D.oilTypeName=Q(D.oilType,g.value)||"":D.oilTypeName="",D.status!=null?D.statusName=Q(D.status,k.value)||"":D.statusName=""})})})};let a=null;const f=C("重新刷新数据"),M=C(!1),K=async()=>{if(M.value)return;et({message:"正在刷新...",forbidClick:!0,duration:0});const o={id:T.query.id,gatewayNo:x.gatewayNo};await At(o),at(),M.value=!0,f.value="刷新等待...",setTimeout(()=>{M.value=!1,f.value="重新刷新数据"},5e3)},U=()=>{a&&(clearInterval(a),a=null),a=setInterval(()=>{v()},2e3)};xt(()=>{x.collectorList.length>0&&U()}),ft(()=>{clearInterval(a),a=null});const n=()=>{S("prev",4)},W=async()=>{Nt({title:"提示",message:"若已安装编码器和显示屏,请重新安装"}).then(()=>{b.value.validate().then(async()=>{for(let u=0;u<e.value.length;u++)for(let c=0;c<e.value[u].taxDataList.length;c++)if(e.value[u].taxDataList[c].status==1){for(let l=0;l<e.value[u].taxDataList[c].gunDataItemList.length;l++)if(!e.value[u].taxDataList[c].gunDataItemList[l].unitPrice&&e.value[u].taxDataList[c].gunDataItemList[l].unitPrice!=0){rt(`采集器${e.value[u].collectorNo}报税口${e.value[u].taxDataList[c].taxNo}油枪${e.value[u].taxDataList[c].gunDataItemList[l].gunNo}单价数据错误`);return}else if(!e.value[u].taxDataList[c].gunDataItemList[l].volume&&e.value[u].taxDataList[c].gunDataItemList[l].volume!=0){rt(`采集器${e.value[u].collectorNo}报税口${e.value[u].taxDataList[c].taxNo}油枪${e.value[u].taxDataList[c].gunDataItemList[l].volume}油量数据错误`);return}else if(!e.value[u].taxDataList[c].gunDataItemList[l].amount&&e.value[u].taxDataList[c].gunDataItemList[l].amount!=0){rt(`采集器${e.value[u].collectorNo}报税口${e.value[u].taxDataList[c].taxNo}油枪${e.value[u].taxDataList[c].gunDataItemList[l].amount}消费金额数据错误`);return}}const o=wt.cloneDeep(x.collectorList);o.forEach((u,c)=>{const l=e.value.find(h=>h.collectorNo==u.collectorNo);l||u.taxItemList.forEach(h=>{h.gunDataItemList=[]}),u.taxItemList.forEach(h=>{let z=l.taxDataList.find(D=>D.taxNo==h.taxNo);z&&(h.gunDataItemList=z.gunDataItemList)})});const $={stationId:T.query.id,gatewayNo:x.gatewayNo,collectorList:o.map(u=>({collectorNo:u.collectorNo,machineId:u.machineId,taxItemList:u.taxItemList.map(c=>({status:c.status,taxNo:c.taxNo,gunList:c.gunDataItemList}))}))};(await Zt($)).code==200&&G.replace({path:F.path,query:{id:T.query.id}})})}).catch(()=>{})};return(o,$)=>{const V=yt,u=Lt,c=it,l=pt,h=vt,z=dt;return r(),p(B,null,[t("div",Ne,[t("div",we,[$[2]||($[2]=t("div",{class:"text"},"油品配置",-1)),y(u,{disabled:M.value,class:"imgsIcon",size:"small",plain:"",hairline:"",type:"primary",onClick:K},{default:j(()=>[y(V,{name:"replay"}),gt(" "+w(f.value),1)]),_:1},8,["disabled"])]),t("div",Ce,"数据路由器编号: "+w(s.gatewayNo),1)]),t("div",ke,[y(z,{ref_key:"formRef",ref:b},{default:j(()=>[(r(!0),p(B,null,A(e.value,(D,X)=>(r(),p("div",{class:"item",key:X},[t("div",Ie,[t("div",be,"采集器编号: "+w(D.collectorNo),1)]),t("div",De,[$[3]||($[3]=t("div",{class:"table-title"},[t("div",{class:"title-item"},"采集器串口"),t("div",{class:"title-item"},"枪号"),t("div",{class:"title-item"},"消费金额/元"),t("div",{class:"title-item"},"油量/L"),t("div",{class:"title-item"},"单价/元"),t("div",{class:"title-item"},"油品型号"),t("div",{class:"title-item"},"状态")],-1)),t("div",Se,[(r(!0),p(B,null,A(D.taxDataList,(R,Y)=>(r(),p("div",{key:Y,class:"content-item"},[t("div",$e,[t("div",Ve,w(R.name),1),t("div",Pe,[(r(!0),p(B,null,A(R.gunDataItemList,(P,E)=>(r(),p("div",{class:"gunItem",key:E},w(P.gunNo),1))),128))]),t("div",Te,[(r(!0),p(B,null,A(R.gunDataItemList,(P,E)=>(r(),p("div",{class:"gunItem",key:E},w(P.amount),1))),128))]),t("div",qe,[(r(!0),p(B,null,A(R.gunDataItemList,(P,E)=>(r(),p("div",{class:"gunItem",key:E},w(P.volume),1))),128))]),t("div",Ue,[(r(!0),p(B,null,A(R.gunDataItemList,(P,E)=>(r(),p("div",{class:"gunItem",key:E},w(P.unitPrice),1))),128))]),t("div",Ee,[(r(!0),p(B,null,A(R.gunDataItemList,(P,E)=>(r(),p("div",{class:"gunItem",key:E},[y(c,{modelValue:P.oilTypeName,"onUpdate:modelValue":ot=>P.oilTypeName=ot,"is-link":"",readonly:"",name:"picker",placeholder:"请选择",onClick:ot=>i(P,X,Y,E,"oilType"),rules:[{required:!0,message:"请选择"}]},null,8,["modelValue","onUpdate:modelValue","onClick"])]))),128))]),t("div",Be,[(r(!0),p(B,null,A(R.gunDataItemList,(P,E)=>(r(),p("div",{class:"gunItem",key:E},[y(c,{modelValue:P.statusName,"onUpdate:modelValue":ot=>P.statusName=ot,"is-link":"",readonly:"",name:"picker",placeholder:"请选择",onClick:ot=>i(P,X,Y,E,"status"),rules:[{required:!0,message:"请选择"}]},null,8,["modelValue","onUpdate:modelValue","onClick"])]))),128))])])]))),128))])]),y(h,{show:d.value,"onUpdate:show":$[1]||($[1]=R=>d.value=R),"destroy-on-close":"",position:"bottom"},{default:j(()=>[y(l,{columns:L.value,onConfirm:_,onCancel:$[0]||($[0]=R=>d.value=!1)},null,8,["columns"])]),_:1},8,["show"])]))),128))]),_:1},512)]),t("div",{class:"footer"},[t("div",{class:"btn",onClick:n},"上一步"),t("div",{class:"nexBtn",onClick:W},"确认安装")])],64)}}},Ge=st(He,[["__scopeId","data-v-ad18822d"]]),Me={class:"dept-list"},Re={class:"components"},Fe={__name:"index",setup(s){const Z=ht(),S=C(1),x=C([{id:1,number:1,name:"路由器安装",status:"success",showNextLine:!0},{id:2,number:2,name:"采集器安装",status:"success",showNextLine:!0},{id:3,number:3,name:"设备状态",status:"success",showNextLine:!0},{id:4,number:4,name:"油品配置",status:"success",showNextLine:!1}]),T=d=>{d==1?history.back():S.value=d-1},G=d=>{if(d==4){Z.replace("/installType");return}S.value=d+1},k=C([]),g=d=>{k.value=d};Ct(()=>S.value,d=>{x.value.forEach(L=>{L.status="success",L.number>d&&(L.status="default")})},{immediate:!0});const F=C(""),b=d=>{F.value=d};return(d,L)=>(r(),p("div",null,[y(kt,{title:"报税口安装"}),t("div",Me,[(r(!0),p(B,null,A(x.value,q=>(r(),lt($t,{Key:q.id,number:q.number,name:q.name,status:q.status,showNextLine:q.showNextLine},null,8,["Key","number","name","status","showNextLine"]))),256))]),t("div",Re,[S.value==1?(r(),lt(Ot,{key:0,onNext:G,onPrev:T,onSendGatewayNo:b})):nt("",!0),S.value==2?(r(),lt(ae,{key:1,onNext:G,onPrev:T,gatewayNo:F.value,onSendCollectorList:g},null,8,["gatewayNo"])):nt("",!0),S.value==3?(r(),lt(Le,{key:2,onNext:G,onPrev:T,gatewayNo:F.value,collectorList:k.value},null,8,["gatewayNo","collectorList"])):nt("",!0),S.value==4?(r(),lt(Ge,{key:3,onNext:G,onPrev:T,gatewayNo:F.value,collectorList:k.value},null,8,["gatewayNo","collectorList"])):nt("",!0)])]))}},We=st(Fe,[["__scopeId","data-v-a0db7a89"]]);export{We as default};
