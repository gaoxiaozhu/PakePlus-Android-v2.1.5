import{W as B,r as h,z as O,X as Y,b as _,d as r,l as n,t as d,u as v,h as $,F,i as M,O as z,E as G,C as y,o as m,L as H,G as R,q as j,J,g as C,Y as W,Z as X}from"./.pnpm-B-_m2kGH.js";import{_ as Z}from"./navBar-Sc4C80VW.js";import{l as A}from"./Group 24-BJuc7rVH.js";import{q as K,b as Q,e as ee}from"./index-4hp_MxG3.js";import{u as oe,a as w}from"./dict-CwYOActj.js";import{u as se}from"./station-DOwaTfnq.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-C1_hm9C_.js";import"./index-DyucNCMT.js";const ne={class:"installList"},te={class:"card"},le={class:"card_icon_content"},ie={class:"icon_num"},ue={key:0},re={class:"label"},ce={class:"value"},de={class:"number"},ve={class:"time"},pe={key:1},_e={class:"footer"},me={__name:"index",setup(fe){const N=G(),f=$(),p=se(),{oil_type_status:k,ref_line_status:b}=oe("oil_type_status","ref_line_status");B(()=>{k.value.forEach(s=>{s.value==90&&(s.disabled=!0)})});const l=h([]),q={text:"value"},P={text:"label",value:"value"},V=[{value:"1"},{value:"2"},{value:"3"},{value:"4"},{value:"5"},{value:"6"},{value:"7"},{value:"8"},{value:"9"},{value:"10"},{value:"11"},{value:"12"},{value:"13"},{value:"14"},{value:"15"},{value:"16"}],x=h([]),T=(s,o)=>{const i=o.selectedOptions[0].value;if(l.value.some(u=>u.gunNo))if(l.value.some(t=>t.gunNo===i)){y("该枪号已存在");return}else s.gunNo=i,s.showPicker=!1;else s.gunNo=i,s.showPicker=!1},I=async()=>{if(l.value.length<1){y("显示屏设备为空,无法进行下一步");return}const s=l.value.every(t=>t.status==1&&t.pinNum),o=l.value.every(t=>t.gunNo);if(!s){y("请检查显示屏状态与针脚数是否正常");return}if(!o){y("枪号内容为必填项");return}const i={machineNo:p.machineNo,screenStatusItemList:l.value,stationId:f.query.id};(await ee(i)).code==200&&(p.number=l.value.length,p.screenStatusItemList=l.value,N.push({path:"/displayListInfo",query:{stationId:f.query.id}}))};h([]);const L=async()=>{const s={stationId:f.query.id,machineNo:p.machineNo,installScreenItemList:p.installScreenItemList};let o=await K(s);l.value=o.data?o.data.screenStatusItemList:[];let i=await Q(s);const u=i.data?i.data.screenStatusItemList:[];l.value.forEach(t=>{u.forEach(c=>{t.screenNo==c.screenNo&&(t.gunNo=c.gunNo,t.oilType=c.oilType,t.oilTypeName=w(c.oilType,k.value))})})},S=h([]),U=(s,o)=>{s.oilTypeName=o.selectedOptions[0].label,s.oilType=o.selectedOptions[0].value,s.oil_Picker=!1};let g=null;return O(()=>{L(),g=setInterval(async()=>{},1e3)}),Y(()=>{clearInterval(g)}),(s,o)=>{const i=Z,u=J,t=W,c=X,D=z;return m(),_("div",null,[r(i,{title:"显示屏安装"}),n("div",ne,[n("div",te,[o[2]||(o[2]=n("div",{class:"card_title"},"基础数据",-1)),n("div",le,[o[1]||(o[1]=n("img",{class:"icon",src:A,alt:""},null,-1)),n("div",ie,"加油机编号："+d(v(f).query.machineNo),1)]),o[3]||(o[3]=n("div",{class:"device_status"},"设备状态",-1)),l.value.length>0?(m(),_("div",ue,[(m(!0),_(F,null,M(l.value,(e,E)=>(m(),_("div",{key:e.index,class:"item"},[n("div",re,[H("显示屏 "+d(E+1)+" ",1),n("span",{class:R({offline:!e.status})},d(v(w)(e.status,v(b))),3)]),n("div",ce,"显示屏编号："+d(e.screenNo),1),n("div",de,"针脚数："+d(e.pinNum),1),n("div",ve,"心跳时间："+d(e.heartTime?v(j)(e.heartTime).format("YYYY-MM-DD HH:mm:ss"):""),1),r(u,{style:{"margin-bottom":"5px"},modelValue:e.gunNo,"onUpdate:modelValue":a=>e.gunNo=a,"is-link":"",readonly:"",label:"枪号",placeholder:"请选择枪号",onClick:a=>e.showPicker=!0,rules:[{required:!0,message:"请选择枪号"}],required:""},null,8,["modelValue","onUpdate:modelValue","onClick"]),r(c,{show:e.showPicker,"onUpdate:show":a=>e.showPicker=a,"destroy-on-close":"",round:"",position:"bottom"},{default:C(()=>[r(t,{"model-value":x.value,columns:V,onCancel:a=>e.showPicker=!1,onConfirm:a=>T(e,a),"columns-field-names":q},null,8,["model-value","onCancel","onConfirm"])]),_:2},1032,["show","onUpdate:show"]),r(u,{modelValue:e.oilTypeName,"onUpdate:modelValue":a=>e.oilTypeName=a,"is-link":"",readonly:"",label:"油品",placeholder:"请选择油品类型",onClick:a=>e.oil_Picker=!0,rules:[{required:!0,message:"请选择油品类型"}],required:""},null,8,["modelValue","onUpdate:modelValue","onClick"]),r(c,{show:e.oil_Picker,"onUpdate:show":a=>e.oil_Picker=a,"destroy-on-close":"",round:"",position:"bottom"},{default:C(()=>[r(t,{"model-value":S.value,columns:v(k),onCancel:a=>e.oil_Picker=!1,onConfirm:a=>U(e,a),"columns-field-names":P},null,8,["model-value","columns","onCancel","onConfirm"])]),_:2},1032,["show","onUpdate:show"])]))),128))])):(m(),_("div",pe,[r(D,{description:"空空如也"})]))]),n("div",_e,[n("div",{class:"btn",onClick:o[0]||(o[0]=()=>v(N).go(-1))},"上一步"),n("div",{class:"nexBtn",onClick:I},"下一步")])])])}}},Pe=ae(me,[["__scopeId","data-v-43926a0b"]]);export{Pe as default};
