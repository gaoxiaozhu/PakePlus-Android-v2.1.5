import{_ as j,r as d,W,z as Z,X as $,b as m,d as p,u as x,l as e,F as V,i as L,L as D,G as ee,t as o,$ as q,g as f,a0 as J,M as se,K as te,Y as ae,Z as le,h as oe,C as k,E as ne,o as v,j as ie,A as ue,J as ce}from"./.pnpm-B-_m2kGH.js";import{_ as re}from"./navBar-Sc4C80VW.js";import{f as de,h as ve,j as me,k as pe}from"./index-4hp_MxG3.js";import{u as _e}from"./station-DOwaTfnq.js";import{u as Ae}from"./displayType-DRjpup3F.js";import{u as he}from"./dict-CwYOActj.js";import{u as fe}from"./patrol-BIApQs8d.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-C1_hm9C_.js";import"./index-DyucNCMT.js";const P="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAADBJREFUKFNjPH/+/AkGBgZzBuLASUaSNRBnMEIVI+01kOwHkjXQ3g8k20CyH0jVAABeUxlLgvrE4AAAAABJRU5ErkJggg==",Ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAAXNSR0IArs4c6QAAAX5JREFUOE+VkLFrk1EUxX/nvnxtDVQJdBBH0b9ARFAQo4v+A04OQiGJog5uImpnqeiiONhBcRQcig4uJalQBwUnB3cXhUyhscl778pnFBXiF3qWC4/7O+/cI6q04sbXrYOW42VzvYn10OX+8eFvRJVw631hGnQkuwM46Hqy+JJHzUHJVcO4WN5qhFpcQzpd8k6+lcffn7N2ti8ubTZwK4hhutFCDOyMGsFqq4gmMPbsqzmPHyu0u0+RyseqFAGoA4u/9oYO92Sd3mfhjdkn/N2OEk5XLG8cYq4onXehEaRiKMpSWh9quyAnqweOJNHuHg7oGNKM5v+1N/FJodN7BX4CZCCH7Hg5KyTcxTdZu3dD+E2kss0o/CPOACn9Fxc5O29Fa2PJZBcl3QYKnF7Cr1Bb6FNsTzfYXiyTjSd3Xn23N8TReZy7uM9h2kw2usDDM/3JKdP1p6TWej3YvnPAA2AeuJb2pxesNONs+GeC1/Ps7Dlq6GTO/ownp75U/fwDSquF4sOla3AAAAAASUVORK5CYII=",ye={key:0,class:"displayList"},be={class:"list"},ke={class:"item_content top"},Ie={class:"name"},Se={class:"item_content"},we={class:"value"},xe={class:"item_content"},Ve={class:"value"},Le={class:"item_content"},Be={class:"value"},Ce={class:"item_content"},Re={class:"value"},Ue={class:"item_content"},Fe={class:"value"},Ee={key:1,class:"checkList"},Oe={class:"header"},De={class:"status"},qe={class:"content"},Je={class:"item"},Pe={class:"labels headers"},Te={class:"labels"},Xe={class:"labels"},He={class:"labels"},Ge={class:"labels"},Ke={class:"labels"},Me={class:"item"},Qe={class:"labels headers"},Ye={class:"labels"},ze={class:"labels"},je={class:"labels"},We={class:"labels"},Ze={class:"footer"},$e={__name:"index",setup(es){const{oil_type_status:I}=he("oil_type_status"),B=fe(),T=Ae(),{displayStatus:S}=j(T),c=_e(),C=ne(),X=oe(),g=d([]),N=d({}),n=d([]),l=d([]),y=d(null),R=d(null),w=d(null),A=d(!1),H=d([]),U=d([]);W(()=>{I.value.length>0&&(I.value.forEach(a=>{a.text=a.label,a.text=="其他"&&(a.disabled=!0)}),U.value=I.value)});const G=a=>{w.value=a,A.value=!0},K=({selectedOptions:a})=>{var s,i;l.value[w.value].oilName=(s=a[0])==null?void 0:s.text,l.value[w.value].oilType=(i=a[0])==null?void 0:i.value,A.value=!1};let b=null;const F=async()=>{let a={stationId:c.stationId,machineNo:c.machineNo,screenStatusItemList:c.screenStatusItemList};if(g.value.forEach(i=>{let u=a.screenStatusItemList.findIndex(r=>r.screenNo==i.screenNo);a.screenStatusItemList[u]={...i,...a.screenStatusItemList[u]}}),S.value){a={stationId:X.query.id,machineNo:c.machineNo,gatewayNo:c.gatewayNo,screenCollectorItemList:c.installScreenCollectorItemList.map(u=>({collectorNo:u.collectorNo,screenNoList:u.installScreenItemList.map(r=>r.screenNo)}))};let i=await de(a);if(N.value=i.data,n.value=i.data.taxDataResList,l.value=i.data.screenDataResList,!n.value||!l.value){k("未查询到数据");return}if(n.value.length<l.value.length){let u=n.value.length,r=l.value.slice(0,u);r.forEach(_=>{delete _.oilName,delete _.oilType}),l.value=[...r,...l.value.splice(u)],console.log(l.value),y.value=l.value.length*220+l.value.length*6+10}else y.value=n.value.length*220+n.value.length*6+10;i.data.status==1&&(clearInterval(b),b=null);return}let s=await ve(a);s.code==200&&(g.value=s.data)},M=()=>{l.value.forEach(a=>{delete a.oilName,delete a.oilType})},Q=()=>{b=setInterval(()=>{F()},3e3)};Z(()=>{F(),Q()});const E=async()=>{if(S.value){const a=async()=>{const s=l.value.map((r,_)=>({...r,...n.value[_]})),i={stationId:c.stationId,machineNo:c.machineNo,gatewayNo:c.gatewayNo,gatewayStatus:c.gatewayStatus,screenStatusItemList:s};(await pe(i)).code==200&&(k("操作成功"),C.replace({path:B.path}))};n.value.length<l.value.length?R.value.validate().then(async()=>{let s=n.value.length,i=l.value.slice(s);i.forEach(u=>{u.status=1,u.collectorNo=n.value[0].collectorNo,u.taxNo=n.value.length+1,u.gunNo=n.value.length+1}),l.value=[...l.value.splice(0,s),...i],a()}).catch(()=>{}):a()}else{if(g.value.length!=c.number){k("读取交易数据设备数量与录入数量不一致,无法完成,请返回后重试");return}const a={stationId:c.stationId,machineNo:c.machineNo,screenStatusItemList:c.screenStatusItemList};(await me(a)).code==200&&(k("操作成功"),C.replace({path:B.path}))}};return $(()=>{clearInterval(b)}),(a,s)=>{const i=re,u=ce,r=se,_=te,Y=ae,z=le;return v(),m("div",null,[p(i,{title:"显示屏列表"}),x(S)==0?(v(),m("div",ye,[e("div",be,[s[9]||(s[9]=e("div",{class:"title"},"交易数据",-1)),(v(!0),m(V,null,L(g.value,(t,h)=>(v(),m("div",{class:"item",key:h},[e("div",ke,[e("div",Ie,"显示屏"+o(h+1),1)]),e("div",Se,[s[4]||(s[4]=e("div",{class:"label"},"显示屏编号",-1)),e("div",we,o(t.screenNo),1)]),e("div",xe,[s[5]||(s[5]=e("div",{class:"label"},"针脚数",-1)),e("div",Ve,o(t.pinNum),1)]),e("div",Le,[s[6]||(s[6]=e("div",{class:"label"},"单价（元）",-1)),e("div",Be,o(t.price),1)]),e("div",Ce,[s[7]||(s[7]=e("div",{class:"label"},"油量（L）",-1)),e("div",Re,o(t.volume),1)]),e("div",Ue,[s[8]||(s[8]=e("div",{class:"label"},"金额（元）",-1)),e("div",Fe,o(t.amount),1)])]))),128))]),e("div",{class:"footer"},[e("div",{class:"nexBtn",onClick:E},"完成")])])):(v(),m("div",Ee,[e("div",Oe,[e("div",De,[s[10]||(s[10]=D("当前数据获取状态 : ")),e("span",{class:ee(["span",N.value.status==1?"":"active"])},o(N.value.status==1?"获取完成":"获取中..."),3)]),e("div",null,"网关编号: "+o(n.value.length>0?n.value[0].gatewayNo:""),1)]),e("div",qe,[e("div",{class:"left",style:q({height:y.value+"px"})},[p(x(J),{ref:"el",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=t=>n.value=t)},{default:f(()=>[(v(!0),m(V,null,L(n.value,t=>(v(),m("div",Je,[e("div",Pe,[e("div",null,"采集器编号: "+o(t.collectorNo),1),s[11]||(s[11]=e("img",{class:"imgs",src:P,alt:""},null,-1))]),e("div",Te,"报税口编号: "+o(t.taxNo),1),e("div",Xe,"加油枪编号: "+o(t.gunNo),1),e("div",He,"金额: "+o(t.amount),1),e("div",Ge,"油量: "+o(t.volume),1),e("div",Ke,"单价: "+o(t.price),1)]))),256))]),_:1},8,["modelValue"])],4),e("div",{class:"right",style:q({height:y.value+"px"})},[p(r,{ref_key:"formRef",ref:R,"label-width":"35px"},{default:f(()=>[p(x(J),{ref:"el",modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=t=>l.value=t),onUpdate:M},{default:f(()=>[(v(!0),m(V,null,L(l.value,(t,h)=>(v(),m("div",Me,[s[13]||(s[13]=e("img",{class:"imgsIcon",src:Ne,alt:""},null,-1)),e("div",Qe,[e("div",null,"显示屏编号: "+o(t.screenNo),1),s[12]||(s[12]=e("img",{class:"imgs",src:P,alt:""},null,-1))]),e("div",Ye,"设备类型: "+o(t.deviceModel),1),e("div",ze,"金额: "+o(t.amount),1),e("div",je,"油量: "+o(t.volume),1),e("div",We,"单价: "+o(t.price),1),h>n.value.length-1?(v(),ie(u,{key:0,modelValue:t.oilName,"onUpdate:modelValue":O=>t.oilName=O,"is-link":"",readonly:"",name:"picker",label:"油品",placeholder:"点击选择油品",onClick:O=>G(h),rules:[{required:!0,message:"请选择油品"}]},null,8,["modelValue","onUpdate:modelValue","onClick"])):ue("",!0)]))),256))]),_:1},8,["modelValue"])]),_:1},512)],4)]),e("div",Ze,[p(_,{class:"nexBtn",onClick:E,disabled:N.value.status!=1},{default:f(()=>s[14]||(s[14]=[D("完成 ")])),_:1},8,["disabled"])])])),p(z,{show:A.value,"onUpdate:show":s[3]||(s[3]=t=>A.value=t),"destroy-on-close":"",position:"bottom"},{default:f(()=>[p(Y,{columns:U.value,"model-value":H.value,onConfirm:K,onCancel:s[2]||(s[2]=t=>A.value=!1)},null,8,["columns","model-value"])]),_:1},8,["show"])])}}},ds=ge($e,[["__scopeId","data-v-823ca65a"]]);export{ds as default};
