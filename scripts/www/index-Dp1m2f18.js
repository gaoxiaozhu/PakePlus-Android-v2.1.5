import{z,W as D,H as k,b as I,o as B,a6 as Y,r as n,h as K,d as o,l as d,g as x,I as Q,L as X,J as ee,U as ae,Z as te,a7 as le,M as oe,Y as ne,u as se,E as ue,F as re,a8 as de,C as P}from"./.pnpm-B-_m2kGH.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ie}from"./navBar-Sc4C80VW.js";import{w as me,x as pe,y as ve,z as ce,A as fe}from"./index-4hp_MxG3.js";import{a as ge}from"./index-CpPjdPay.js";import{u as ye,a as Ve}from"./dict-CwYOActj.js";import"./request-C1_hm9C_.js";import"./index-DyucNCMT.js";const xe={id:"mapDiv"},_e={__name:"myMap",props:["lng","lat"],emits:["getLngLat"],setup(h,{expose:p,emit:f}){let u=null,g=15,y=null;const r=h,m=f,_=()=>{u=new T.Map("mapDiv",{projection:"EPSG:4326"}),u.centerAndZoom(new T.LngLat(116.40769,39.89945),g),y=new T.Geolocation},b=()=>{function v(a){if(k({message:"重新获取位置中...",forbidClick:!0}),this.getStatus()==0||this.getStatus()==1){u.clearOverLays();const c=a.lnglat;u.centerAndZoom(c,15),m("getLngLat",c);let L=new T.Marker(c);u.addOverLay(L)}else Y("定位失败，错误码："+this.getStatus)}y.getCurrentPosition(v)};return z(()=>{_()}),D(()=>{if(r.lng&&r.lat&&u){k({message:"油站位置加载...",forbidClick:!0}),u.centerAndZoom(new T.LngLat(r.lng,r.lat),g);let v=new T.Marker(new T.LngLat(r.lng,r.lat));u.addOverLay(v)}}),p({getLocation:b}),(v,a)=>(B(),I("div",xe))}},be=F(_e,[["__scopeId","data-v-678a7716"]]),we={class:"address"},Ce={class:"box"},Le={style:{"box-sizing":"border-box",padding:"16px 16px"}},Te={class:"footer"},ke={__name:"index",setup(h){const{station_type_status:p}=ye("station_type_status"),f=ue(),u=K(),g=n(null),y=n(null),r=n([]),m=n(!1),_=n([]),b=n([]),v=({selectedValues:t,selectedOptions:e})=>{var i,C;a.value.stationType=(i=e[0])==null?void 0:i.value,a.value.stationTypeName=(C=e[0])==null?void 0:C.text,_.value=t,m.value=!1};D(()=>{p.value&&p.value.length>0&&(b.value=p.value.map(t=>({text:t.label,value:t.value})))});const a=n({name:"",address:""}),c=n(null),L=()=>{c.value.validate().then(async()=>{const t=k({message:"加载中...",forbidClick:!0,duration:0});w.value?ce(a.value).then(e=>{e.code==200&&(P("修改成功"),f.push({path:"/home"}))}):fe(a.value).then(async e=>{e.code==200&&(P("新增成功"),await ge({installStatus:2,stationId:e.data.id}),f.push({path:"/setup"}))}),t.close()})},M=async()=>{let t=await pe({id:w.value});a.value={...a.value,...t.data},a.value.latitude&&a.value.longitude&&(g.value=a.value.longitude,y.value=a.value.latitude),a.value.stationTypeName=Ve(t.data.stationType,p.value),t.data.showBusinessLicensePic&&(r.value=[{url:t.data.showBusinessLicensePic,isImage:!0}])},V=n(!1),N=n([]),S={text:"label",value:"id",children:"children"},R=async()=>{let t=await me();N.value=t.data[0].children},$=({selectedOptions:t})=>{V.value=!1,a.value.deptName=t[t.length-1].label},A=({selectedOptions:t,tabIndex:e,value:i})=>{a.value.deptName=t[t.length-1].label,a.value.deptId=t[t.length-1].id},w=n(null);z(()=>{R(),w.value=u.query.id,w.value&&M()});const E=async t=>{t.status="uploading",t.message="上传中...";let e=new FormData;e.append("file",t.file);let i=await ve(e);i.code==200&&(t.status="done",t.message="上传成功",a.value={...a.value,...i.data})},U=n(null),G=()=>{de({title:"提示",message:"重新获取经纬度信息将清空原有经纬度信息，是否确认重新获取？"}).then(()=>{U.value.getLocation()}).catch(()=>{})},O=t=>{a.value.longitude=t.lng,a.value.latitude=t.lat};return(t,e)=>{const i=ie,C=ae,s=ee,Z=le,q=te,j=be,H=Q,J=oe,W=ne;return B(),I(re,null,[o(i,{title:"信息录入"}),d("div",we,[o(J,{ref_key:"formRef",ref:c},{default:x(()=>[o(H,{inset:""},{default:x(()=>[d("div",Ce,[e[19]||(e[19]=d("div",{class:"title"},[X("信息登记 "),d("span",{style:{color:"red"}},"(上传营业执照自动识别)")],-1)),o(s,{label:"营业执照",name:"file",required:"",rules:[{required:!0,message:"请上传营业执照"}]},{input:x(()=>[o(C,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),"max-count":1,"after-read":E},null,8,["modelValue"])]),_:1})]),o(s,{type:"textarea",modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.name=l),name:"name",label:"加油站名称",placeholder:"加油站名称",autosize:"",required:"",rules:[{required:!0,message:"请填写加油站名称"}]},null,8,["modelValue"]),o(s,{type:"textarea",modelValue:a.value.deptName,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.deptName=l),name:"deptName","is-link":"",readonly:"",label:"所属税务机关",placeholder:"请选择所属税务机关",onClick:e[3]||(e[3]=l=>V.value=!0),required:"",rules:[{required:!0,message:"请选择所属税务机关"}]},null,8,["modelValue"]),o(q,{show:V.value,"onUpdate:show":e[6]||(e[6]=l=>V.value=l),round:"",position:"bottom"},{default:x(()=>[o(Z,{modelValue:a.value.deptId,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.deptId=l),title:"请选择所在地区",options:N.value,onClose:e[5]||(e[5]=l=>V.value=!1),onFinish:$,"field-names":S,closeable:!1,onChange:A},null,8,["modelValue","options"])]),_:1},8,["show"]),o(s,{modelValue:a.value.stationTypeName,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.stationTypeName=l),"is-link":"",readonly:"",name:"stationTypeName",label:"加油站类型",placeholder:"加油站类型",onClick:e[8]||(e[8]=l=>m.value=!0),required:"",rules:[{required:!0,message:"请选择加油站类型"}]},null,8,["modelValue"]),o(s,{type:"textarea",modelValue:a.value.taxpayerName,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.taxpayerName=l),name:"taxpayerName",label:"纳税人名称",placeholder:"纳税人名称",autosize:"",required:"",rules:[{required:!0,message:"请填写纳税人名称"}]},null,8,["modelValue"]),o(s,{required:"",rules:[{required:!0,message:"请填写纳税人识别号"}],type:"textarea",modelValue:a.value.unifiedCreditCode,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.unifiedCreditCode=l),name:"unifiedCreditCode",label:"纳税人识别号",placeholder:"纳税人识别号",autosize:""},null,8,["modelValue"]),o(s,{type:"textarea",modelValue:a.value.address,"onUpdate:modelValue":e[11]||(e[11]=l=>a.value.address=l),name:"address",label:"经营地址",placeholder:"经营地址",autosize:""},null,8,["modelValue"]),o(s,{type:"textarea",modelValue:a.value.companyType,"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.companyType=l),name:"companyType",label:"登记注册类型",placeholder:"登记注册类型",autosize:""},null,8,["modelValue"]),o(s,{type:"textarea",modelValue:a.value.openingDate,"onUpdate:modelValue":e[13]||(e[13]=l=>a.value.openingDate=l),name:"openingDate",label:"开业时间",placeholder:"开业时间",autosize:""},null,8,["modelValue"]),o(s,{type:"textarea",modelValue:a.value.taxationOfficerName,"onUpdate:modelValue":e[14]||(e[14]=l=>a.value.taxationOfficerName=l),name:"taxationOfficerName",label:"办税人员",placeholder:"办税人员",autosize:""},null,8,["modelValue"]),o(s,{type:"textarea",modelValue:a.value.legalPerson,"onUpdate:modelValue":e[15]||(e[15]=l=>a.value.legalPerson=l),name:"legalPerson",label:"法定代表人",placeholder:"法定代表人",autosize:""},null,8,["modelValue"]),d("button",{onClick:G,class:"get_nexBtn"},"重新获取定位"),d("div",Le,[o(j,{ref_key:"myMapRef",ref:U,lng:g.value,lat:y.value,onGetLngLat:O},null,8,["lng","lat"])])]),_:1})]),_:1},512),o(q,{show:m.value,"onUpdate:show":e[17]||(e[17]=l=>m.value=l),"destroy-on-close":"",position:"bottom"},{default:x(()=>[o(W,{columns:b.value,"model-value":_.value,onConfirm:v,onCancel:e[16]||(e[16]=l=>m.value=!1)},null,8,["columns","model-value"])]),_:1},8,["show"]),d("div",Te,[d("div",{class:"btn",onClick:e[18]||(e[18]=()=>se(f).go(-1))},"返回"),d("div",{class:"nexBtn",onClick:L},"确认")])])],64)}}},Be=F(ke,[["__scopeId","data-v-892052b0"]]);export{Be as default};
